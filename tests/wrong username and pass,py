
import pytest
from playwright.sync_api import sync_playwright, expect

def test_wrong_username_and_password():
    with sync_playwright() as playwright:
        browser = playwright.chromium.launch(headless=False, slow_mo=300)
        context = browser.new_context()
        page = context.new_page()

        # 1. Open login page
        page.goto(
            "https://demo.ehrconnect.healthconnect.systems/login",
            wait_until="domcontentloaded"
        )

        # 2. Wait for login fields
        page.wait_for_selector("input[name='username']", timeout=20000)
        page.wait_for_selector("input[name='password']", timeout=20000)

        # 3. Enter WRONG username & WRONG password
        page.fill("input[name='username']", "wronguser123")
        page.fill("input[name='password']", "WrongPass@123")

        # 4. Click Login
        page.click("button[type='submit']")

        # 5. Wait for response
        page.wait_for_load_state("networkidle")

        # 6. Validate error message is displayed
        error_locator = page.locator(
            "text=/invalid|incorrect|failed|error|unauthorized/i"
        )
        expect(error_locator.first).to_be_visible(timeout=20000)

        # 7. Ensure user is still on login page (not dashboard) using regex
        expect(page).to_have_url(r".*login.*")

        print("âœ… Invalid login (wrong username + password) verified successfully.")
        # browser.close()
